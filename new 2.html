<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุฑู ูุธุฑุณูุฌ ุญุฑููโุง ู ฺฉุงููุงู ูพูุง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ุงุณุชุงูโูุง ูพุงู ู ูููุช */
        body {
            font-family: 'Vazirmatn', sans-serif;
            scroll-behavior: smooth;
        }

        /* ุงููุดู ุจููู ุดุฏู ุจุฑุง ุจุงุฒ ู ุจุณุชู ุดุฏู ุจุฎุดโูุง */
        .collapsible {
            display: grid;
            grid-template-rows: 0fr; /* ุดุฑูุน ุฏุฑ ุญุงูุช ุจุณุชู */
            opacity: 0;
            overflow: hidden;
            transition: grid-template-rows 0.4s ease, opacity 0.3s ease, margin-top 0.4s ease;
            margin-top: 0;
        }

        .collapsible.show {
            grid-template-rows: 1fr; /* ุจุงุฒ ุดุฏู ุจู ุงูุฏุงุฒู ูุญุชูุง ุฏุงุฎู */
            opacity: 1;
            margin-top: 1.5rem; /* ูุงุตูู ุฏุฑ ุญุงูุช ุจุงุฒ */
        }
        
        /* ุฌููฺฏุฑ ุงุฒ ูพุฑุด ูุญุชูุง ุฏุฑ ุญู ุงููุดู */
        .collapsible > div {
            min-height: 0;
        }
        
        /* ูุฎู ฺฉุฑุฏู ูพุดโูุฑุถ ุจุฎุดโูุง ุดุฑุท ุจุง ุฌุงูุง ุงุณฺฉุฑูพุช */
        .conditional-section, .delivery-specific-option, .item-type-specific-option {
            display: none;
        }
        
        /* ุจูุจูุฏ ุฏุณุชุฑุณโูพุฐุฑ: ููุงุด ุญููู ููฺฉูุณ ููุท ุจุฑุง ฺฉุงุฑุจุฑุงู ฺฉุจูุฑุฏ */
        :focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen py-12">

    <div class="w-full max-w-3xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800">ูุฑู ูุธุฑุณูุฌ ุฑุถุงุช ูุฑูุดูุฏู</h1>
            <p class="text-slate-500 mt-2">ุงุฒ ุงูฺฉู ููุช ุฎูุฏ ุฑุง ุจุฑุง ุจูุจูุฏ ุฎุฏูุงุช ูุง ุตุฑู ูโฺฉูุฏุ ุณูพุงุณฺฏุฒุงุฑู.</p>
        </header>

        <div class="grid md:grid-cols-2 gap-6 mb-6">
            <div>
                <label for="itemType" class="block text-md font-semibold text-slate-700 mb-2">ููุน ฺฉุงูุง:</label>
                <select id="itemType" class="w-full p-3 bg-white border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    <option value="main_warehouse">ุงูุจุงุฑ ฺฉุงูุง ูุงุจู ูุฑูุด</option>
                    <option value="returned" selected>ุงูุจุงุฑ ูุฑุฌูุน</option>
                    <option value="sample">ููููู (ุณููพู)ู ุงูุจุงูุฏ ุฑุฌฺฉุดู</option>
                </select>
            </div>
            <div>
                <label for="deliveryMethod" class="block text-md font-semibold text-slate-700 mb-2">ูุญูู ุงุฑุณุงู:</label>
                <select id="deliveryMethod" class="w-full p-3 bg-white border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition">
                    <option value="fleet" selected>ุชูุฑุงู (ูุงูฺฏุงู)</option>
                    <option value="post">ูพุณุช</option>
                    <option value="in_person">ุญุถูุฑ (ุชูุฑุงู ู ุดูุฑุณุชุงู)</option>
                </select>
            </div>
        </div>

        <form id="surveyForm" class="space-y-6">
            
            <fieldset id="primaryQuestionContainer" class="p-6 bg-slate-50 rounded-xl">
                <legend class="text-lg font-semibold text-slate-800 mb-4">ุงุฒ ูุฑุขูุฏ ฺฉู ุฏุฑุงูุช ฺฉุงูุง ฺูุฏุฑ ุฑุถุงุช ุฏุงุดุชุฏุ</legend>
                <div class="flex flex-wrap gap-x-8 gap-y-4">
                    <label class="flex items-center cursor-pointer"><input type="radio" name="primary_satisfaction" value="5" class="form-radio text-green-500 h-5 w-5"><span class="ms-2 text-slate-700">ุฎู ุฒุงุฏ</span></label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="primary_satisfaction" value="4" class="form-radio text-lime-500 h-5 w-5"><span class="ms-2 text-slate-700">ุฒุงุฏ</span></label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="primary_satisfaction" value="3" class="form-radio text-yellow-500 h-5 w-5"><span class="ms-2 text-slate-700">ูุชูุณุท</span></label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="primary_satisfaction" value="2" class="form-radio text-orange-500 h-5 w-5"><span class="ms-2 text-slate-700">ฺฉู</span></label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="primary_satisfaction" value="1" class="form-radio text-red-500 h-5 w-5"><span class="ms-2 text-slate-700">ุฎู ฺฉู</span></label>
                </div>
            </fieldset>

            <div id="detailedQuestionsContainer" class="collapsible" aria-hidden="true">
                <div class="space-y-6">
                    <hr>
                    <p class="text-center text-slate-600 font-medium">ุงุฒ ุงูฺฉู ุจุงุฒุฎูุฑุฏ ุฎูุฏ ุฑุง ุจุง ูุง ุฏุฑ ูุงู ูโฺฏุฐุงุฑุฏ ุณูพุงุณฺฏุฒุงุฑู. ูุทูุงู ุจู ุณูุงูุงุช ุฒุฑ ูพุงุณุฎ ุฏูุฏ.</p>
                    
                    <fieldset id="returnQuestionContainer" class="p-6 bg-slate-50 rounded-xl conditional-section">
                        <legend class="text-lg font-semibold text-slate-800 mb-4">ุงูู) ุงุฒ ูุญูู ุจุฑุฑุณ ฺฉุงูุง ูุฑุฌูุน ฺูุฏุฑ ุฑุถุงุช ุฏุงุดุชุฏุ</legend>
                        <div class="flex flex-wrap gap-x-6 gap-y-3" data-controls-sub-question="return_sub_questions_container">
                            <label class="flex items-center cursor-pointer"><input type="radio" name="return_satisfaction" value="5" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฎู ุฒุงุฏ</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="return_satisfaction" value="4" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฒุงุฏ</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="return_satisfaction" value="3" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ูุชูุณุท</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="return_satisfaction" value="2" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ฺฉู</span></label>
                            <label class="flex items-center cursor-pointer"><input type="radio" name="return_satisfaction" value="1" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฎู ฺฉู</span></label>
                        </div>
                        <div id="return_sub_questions_container" class="collapsible" aria-hidden="true">
                                <div class="bg-yellow-50 border-r-4 border-yellow-400 rounded-lg p-4">
                                    <p class="font-semibold mb-3 text-gray-800">ฺฉุฏุงู ููุงุฑุฏ ุฏุฑ ููุฑุฏ ุจุฑุฑุณ ฺฉุงูุง ุตุฏู ูโฺฉูุฏุ</p>
                                    <div class="space-y-2">
                                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="return_reason" value="unclear_result" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ูุณุชูุฏุงุช ู ุฏูุงู ฺฉุงุฑุดูุงุณ ุจุฑุง ุฑุฏ ุง ุชุงุฏ ูุฑุฌูุนุ ูุงูุนโฺฉููุฏู ุง ฺฉุงู ูุจูุฏ.</span></label>
                                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="return_reason" value="item_damaged" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ฺฉุงูุง ุขุณุจ ุฏุฏู ู ุจุงุดุฏ.</span></label>
                                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="return_reason" value="item_incomplete" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ูุณูุช ุงุฒ ฺฉุงูุง ุงุฑุณุงู ูุดุฏู .</span></label>
                                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="return_reason" value="wrong_item" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ฺฉุงูุง ูู ุนูุถ ุดุฏู .</span></label>
                                        <div class="other-option-wrapper">
                                            <label class="flex items-center cursor-pointer"><input type="checkbox" name="return_reason" value="other" class="form-checkbox rounded" data-controls-textarea><span class="ms-2 text-gray-700">ุณุงุฑ ููุงุฑุฏ</span></label>
                                            <div class="collapsible w-full mt-0!" aria-hidden="true"><textarea name="return_reason_other_text" rows="2" class="w-full p-2 mt-2 border border-gray-300 rounded-lg"></textarea></div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </fieldset>

                    <fieldset id="deliveryTimeQuestionContainer" class="p-6 bg-slate-50 rounded-xl conditional-section">
                        <legend class="text-lg font-semibold text-slate-800 mb-4">ุจ) ุงุฒ ูุฏุช ุฒูุงู ู ูุญูู ุชุญูู ฺฉุงูุง ฺูุฏุฑ ุฑุถุงุช ุฏุงุดุชุฏุ</legend>
                        <div class="flex flex-wrap gap-x-6 gap-y-3" data-controls-sub-question="delivery_time_sub_questions_container">
                           <label class="flex items-center cursor-pointer"><input type="radio" name="delivery_time_satisfaction" value="5" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฎู ุฒุงุฏ</span></label>
                           <label class="flex items-center cursor-pointer"><input type="radio" name="delivery_time_satisfaction" value="4" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฒุงุฏ</span></label>
                           <label class="flex items-center cursor-pointer"><input type="radio" name="delivery_time_satisfaction" value="3" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ูุชูุณุท</span></label>
                           <label class="flex items-center cursor-pointer"><input type="radio" name="delivery_time_satisfaction" value="2" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ฺฉู</span></label>
                           <label class="flex items-center cursor-pointer"><input type="radio" name="delivery_time_satisfaction" value="1" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฎู ฺฉู</span></label>
                        </div>
                        <div id="delivery_time_sub_questions_container" class="collapsible" aria-hidden="true">
                           <div class="bg-yellow-50 border-r-4 border-yellow-400 rounded-lg p-4">
                                <p class="font-semibold mb-3 text-gray-800">ฺฉุฏุงู ููุงุฑุฏ ุจุงุนุซ ูุงุฑุถุงุช ุดูุง ุงุฒ ุฒูุงู ู ูุญูู ุชุญูู ุดุฏุ</p>
                                <div class="space-y-2">
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="delivery_time_reason" value="longer_than_promised" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ุจุงุฒู ููุงุด ุฏุงุฏู ุดุฏู ุจุฑุง ุงูุชุฎุงุจ ุฒูุงู ุชุญูู ุทููุงู ุจูุฏ.</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="delivery_time_reason" value="not_on_time" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ุชุญูู ุฏุฑ ุจุงุฒู ุงูุชุฎุงุจ ุดุฏู ุตูุฑุช ูฺฏุฑูุช.</span></label>
                                    <label class="flex items-center cursor-pointer delivery-specific-option" data-method="fleet"><input type="checkbox" name="delivery_time_reason" value="driver_behavior" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ุจุฑุฎูุฑุฏ ุฑุงููุฏู ูุงููุงุณุจ ุจูุฏ.</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="delivery_time_reason" value="bad_packaging" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ุจุณุชู ุจูุฏ ฺฉุงูุง ููุงุณุจ ูุจูุฏ.</span></label>
                                    <label class="flex items-center cursor-pointer item-type-specific-option" data-item-types="main_warehouse sample"><input type="checkbox" name="delivery_time_reason" value="item_damaged" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ฺฉุงูุง ุขุณุจ ุฏุฏู ุจูุฏ.</span></label>
                                    
                                    <div class="other-option-wrapper">
                                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="delivery_time_reason" value="other" class="form-checkbox rounded" data-controls-textarea><span class="ms-2 text-gray-700">ุณุงุฑ ููุงุฑุฏ</span></label>
                                        <div class="collapsible w-full mt-0!" aria-hidden="true"><textarea name="delivery_time_reason_other_text" rows="2" class="w-full p-2 mt-2 border border-gray-300 rounded-lg"></textarea></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset id="inPersonQuestionContainer" class="p-6 bg-slate-50 rounded-xl conditional-section">
                        <legend class="text-lg font-semibold text-slate-800 mb-4">ุฏ) ุงุฒ ุชุฌุฑุจู ุชุญูู ุญุถูุฑ ฺูุฏุฑ ุฑุถุงุช ุฏุงุดุชุฏุ</legend>
                          <div class="flex flex-wrap gap-x-6 gap-y-3" data-controls-sub-question="in_person_sub_questions_container">
                           <label class="flex items-center cursor-pointer"><input type="radio" name="in_person_satisfaction" value="5" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฎู ุฒุงุฏ</span></label>
                           <label class="flex items-center cursor-pointer"><input type="radio" name="in_person_satisfaction" value="4" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฒุงุฏ</span></label>
                           <label class="flex items-center cursor-pointer"><input type="radio" name="in_person_satisfaction" value="3" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ูุชูุณุท</span></label>
                           <label class="flex items-center cursor-pointer"><input type="radio" name="in_person_satisfaction" value="2" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ฺฉู</span></label>
                           <label class="flex items-center cursor-pointer"><input type="radio" name="in_person_satisfaction" value="1" class="form-radio h-5 w-5"><span class="ms-2 text-gray-700">ุฎู ฺฉู</span></label>
                        </div>
                        <div id="in_person_sub_questions_container" class="collapsible" aria-hidden="true">
                            <div class="bg-yellow-50 border-r-4 border-yellow-400 rounded-lg p-4">
                                <p class="font-semibold mb-3 text-gray-800">ฺฉุฏุงู ููุงุฑุฏ ุฏุฑ ุชุฌุฑุจู ุดูุง ุชุงุซุฑ ููู ุฏุงุดุชุ</p>
                                <div class="space-y-2">
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="in_person_reason" value="bad_location_access" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ุฏุณุชุฑุณ ูุญู ุชุญูู ูุงููุงุณุจ ุจูุฏ.</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="in_person_reason" value="bad_location_environment" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ุดุฑุงุท ูุญู ุชุญูู ฺฉุงูุง ูุงููุงุณุจ ุจูุฏ.</span></label>                                   
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="in_person_reason" value="staff_behavior" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ุจุฑุฎูุฑุฏ ฺฉุงุฑุดูุงุณ ุชุญูู ุบุฑุญุฑููโุง ุจูุฏ.</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="in_person_reason" value="long_wait" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ุฒูุงู ุงูุชุธุงุฑ ุฏุฑ ูุญู ุชุญูู ุทููุงู ุจูุฏ.</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="in_person_reason" value="no_parking" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ูุญู ููุงุณุจ ุฌูุช ูพุงุฑฺฉ ุฎูุฏุฑู ูุฌูุฏ ูุฏุงุดุช .</span></label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" name="in_person_reason" value="complex_process" class="form-checkbox rounded"><span class="ms-2 text-gray-700">ูพุฑูุณู ุชุญูู ฺฉุงูุง ูพฺุฏู ู ุจุงุดุฏ .</span></label>
                                    <div class="other-option-wrapper">
                                        <label class="flex items-center cursor-pointer"><input type="checkbox" name="in_person_reason" value="other" class="form-checkbox rounded" data-controls-textarea><span class="ms-2 text-gray-700">ุณุงุฑ ููุงุฑุฏ</span></label>
                                        <div class="collapsible w-full mt-0!" aria-hidden="true"><textarea name="in_person_reason_other_text" rows="2" class="w-full p-2 mt-2 border border-gray-300 rounded-lg"></textarea></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
                    
            <div id="positiveFeedbackContainer" class="collapsible" aria-hidden="true">
                <fieldset class="p-6 bg-green-50 border-r-4 border-green-500 rounded-lg">
                    <legend class="block text-lg font-semibold text-slate-800 mb-2">ุงุฒ ุฑุถุงุช ุดูุง ุฎุฑุณูุฏู! ๐</legend>
                    <label for="positive_feedback" class="text-slate-600 mb-4 block">ุงฺฏุฑ ูพุดููุงุฏ ุง ูฺฉุชูโุง ุจุฑุง ูุง ุฏุงุฑุฏุ ูุดุชุงูุงูู ูโุดููู. (ุงุฎุชุงุฑ)</label>
                    <textarea id="positive_feedback" name="positive_feedback" rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition" placeholder="..."></textarea>
                </fieldset>
            </div>

            <div id="submitButtonContainer" class="collapsible" aria-hidden="true">
                <div class="mt-4 text-center">
                    <button type="submit" class="w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-12 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-105">
                        ุซุจุช ููุง ูุธุฑุณูุฌ
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ุงูุชุฎุงุจโฺฏุฑูุง ุงุตู ---
            const form = document.getElementById('surveyForm');
            const itemTypeSelect = document.getElementById('itemType');
            const deliveryMethodSelect = document.getElementById('deliveryMethod');
            
            // --- ุชูุงุจุน ฺฉูฺฉ ุจุฑุง ูุฏุฑุช ููุงุด ---
            const setCollapsibleVisibility = (element, show) => {
                if (!element) return;
                const isVisible = element.classList.contains('show');
                if (isVisible === show) return;
                element.classList.toggle('show', show);
                element.setAttribute('aria-hidden', !show);
            };

            const setElementDisplay = (element, show) => {
                if (element) {
                    element.style.display = show ? 'block' : 'none';
                }
            };
            
            // --- ุชุงุจุน ุงุตู ุจุฑุง ูุฏุฑุช ฺฉู UI ูุฑู ---
            const updateFormState = () => {
                const primaryRating = Number(form.querySelector('input[name="primary_satisfaction"]:checked')?.value || 0);
                const deliveryMethod = deliveryMethodSelect.value;
                const itemType = itemTypeSelect.value;

                const showDetailed = primaryRating > 0 && primaryRating <= 2;
                const showPositive = primaryRating >= 3;
                const showSubmit = primaryRating > 0;

                // ฑ. ูุฏุฑุช ุจุฎุดโูุง ุงุตู (ุณูุงูุงุช ุฌุฒุฆุ ุจุงุฒุฎูุฑุฏ ูุซุจุชุ ุฏฺฉูู ุซุจุช)
                setCollapsibleVisibility(document.getElementById('detailedQuestionsContainer'), showDetailed);
                setCollapsibleVisibility(document.getElementById('positiveFeedbackContainer'), showPositive);
                setCollapsibleVisibility(document.getElementById('submitButtonContainer'), showSubmit);
                
                // ุงฺฏุฑ ุจุฎุด ุณูุงูุงุช ุฌุฒุฆ ููุงุด ุฏุงุฏู ููโุดูุฏุ ฺฉุงุฑ ุชูุงู ุงุณุช
                if (!showDetailed) {
                     // ูุฎู ฺฉุฑุฏู ุชูุงู ุจุฎุดโูุง ุฏุงุฎู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ููุงุด ูุงุฎูุงุณุชู
                    document.querySelectorAll('.conditional-section, .delivery-specific-option, .item-type-specific-option').forEach(el => {
                        el.style.display = 'none';
                    });
                    return;
                }

                // ฒ. ูุฏุฑุช ููุงุด ุณูุงูุงุช ุดุฑุท ุงุตู
                setElementDisplay(document.getElementById('returnQuestionContainer'), itemType === 'returned');
                setElementDisplay(document.getElementById('deliveryTimeQuestionContainer'), true); // ููุดู ููุงุด ุฏุงุฏู ุดูุฏ
                setElementDisplay(document.getElementById('inPersonQuestionContainer'), deliveryMethod === 'in_person');

                // ณ. ูุฏุฑุช ฺฏุฒููโูุง ุดุฑุท ุฏุงุฎู ุจุฑ ุงุณุงุณ ูุญูู ุงุฑุณุงู
                form.querySelectorAll('.delivery-specific-option').forEach(el => {
                    const methods = el.dataset.method.split(' ');
                    el.style.display = methods.includes(deliveryMethod) ? 'flex' : 'none';
                });

                // ูุฏุฑุช ฺฏุฒููโูุง ุดุฑุท ุฏุงุฎู ุจุฑ ุงุณุงุณ ููุน ฺฉุงูุง
                form.querySelectorAll('.item-type-specific-option').forEach(el => {
                    const allowedTypes = el.dataset.itemTypes.split(' ');
                    el.style.display = allowedTypes.includes(itemType) ? 'flex' : 'none';
                });

                // ด. ูุฏุฑุช ููุงุด ุชูุงู ุฒุฑ-ุณูุงูุงุช (ุจุฎุด ฺฺฉโุจุงฺฉุณโูุง)
                form.querySelectorAll('[data-controls-sub-question]').forEach(radioGroupContainer => {
                    const ratingValue = radioGroupContainer.querySelector('input[type="radio"]:checked')?.value;
                    const subQuestionContainer = document.getElementById(radioGroupContainer.dataset.controlsSubQuestion);
                    setCollapsibleVisibility(subQuestionContainer, ratingValue && Number(ratingValue) <= 2);
                });

                // ต. ูุฏุฑุช ููุงุด ููุฏ ูุชู "ุณุงุฑ ููุงุฑุฏ"
                form.querySelectorAll('input[type="checkbox"][data-controls-textarea]').forEach(checkbox => {
                    const wrapper = checkbox.closest('.other-option-wrapper');
                    const textareaContainer = wrapper?.querySelector('.collapsible');
                    setCollapsibleVisibility(textareaContainer, checkbox.checked);
                });
            };

            // --- ุฑุงูโุงูุฏุงุฒ ู ุงุชุตุงู ุฑูุฏุงุฏูุง ---
            form.addEventListener('change', updateFormState);
            itemTypeSelect.addEventListener('change', updateFormState);
            deliveryMethodSelect.addEventListener('change', updateFormState);

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                console.log('ูุฑู ุจุฑุง ุงุฑุณุงู ุขูุงุฏู ุงุณุช.');
                const formData = new FormData(form);
                
                // ุงูุฒูุฏู ููุงุฏุฑ select ูุง ุจู formData ฺูู ุฎุงุฑุฌ ุงุฒ ุชฺฏ form ูุณุชูุฏ
                formData.append('item_type', itemTypeSelect.value);
                formData.append('delivery_method', deliveryMethodSelect.value);

                for (let [key, value] of formData.entries()) {
                    console.log(key, ':', value);
                }
                alert('ูุธุฑุณูุฌ ุดูุง ุจุง ููููุช ุซุจุช ุดุฏ. (ูุชุฌู ุฏุฑ ฺฉูุณูู ููุงุด ุฏุงุฏู ุดุฏู ุงุณุช)');
            });
            
            // --- ุงุฌุฑุง ุงููู ---
            updateFormState(); // ูุฑุงุฎูุงู ุงููู ุจุฑุง ุชูุธู ุญุงูุช ูุฑู ุจุฑ ุงุณุงุณ ููุงุฏุฑ ูพุดโูุฑุถ
        });
    </script>
</body>

</html>
